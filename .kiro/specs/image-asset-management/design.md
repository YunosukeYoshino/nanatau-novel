# 設計書

## 概要

「ななたう」ビジュアルノベルのための包括的な画像アセット管理システムの設計書です。このシステムは、物語の世界観（広島・宇品地区、ステンドグラス、記憶と超越のテーマ）に基づいて、必要なすべての視覚的アセットを体系的に管理し、AI画像生成のための最適化されたプロンプトを提供します。

## アーキテクチャ

### システム構成

```
image-asset-management/
├── asset-catalog/           # アセットカタログ
│   ├── backgrounds/         # 背景画像カタログ
│   ├── characters/          # キャラクタースプライトカタログ
│   ├── ui-elements/         # UI要素カタログ
│   └── special-effects/     # 特殊効果カタログ
├── generation-prompts/      # AI生成プロンプト集
│   ├── character-prompts/   # キャラクター生成プロンプト
│   ├── background-prompts/  # 背景生成プロンプト
│   ├── ui-prompts/         # UI生成プロンプト
│   └── effect-prompts/     # エフェクト生成プロンプト
├── style-guide/            # スタイルガイド
├── production-workflow/    # 制作ワークフロー
└── quality-control/        # 品質管理
```

### データフロー

1. **アセット要件分析** → シナリオ分析に基づく必要アセットの特定
2. **プロンプト生成** → 各アセットに対する最適化されたAI生成プロンプト作成
3. **アセット生成** → AIツールを使用した画像生成
4. **品質管理** → 生成されたアセットの品質チェックと承認
5. **実装** → ゲームプロジェクトへの統合

## コンポーネントと インターフェース

### 1. アセットカタログシステム

#### 背景画像カタログ
- **外部環境**
  - 宇品の坂道（夕暮れ、昼間、夜）
  - 広島港と瀬戸内海の景色
  - 丘の上の廃教会（外観）
  - 住宅街の風景
  - 夏祭りの神社境内

- **内部環境**
  - 廃教会内部（メインステンドグラス）
  - 主人公の自室
  - 学校の教室
  - ステンドグラス内の菜の花畑世界

#### キャラクタースプライト
- **ななたう**
  - 基本立ち絵（ステンドグラス内）
  - 表情バリエーション（微笑み、悲しみ、驚き、苦痛）
  - 透明度効果バリエーション
  - ヒビ割れエフェクト付きバージョン

- **主人公**
  - シルエット版（没入感重視）
  - 一部可視版（回想シーン用）
  - 子供時代バージョン

#### UI要素
- ダイアログボックス（ステンドグラス風装飾）
- メニュー背景
- ボタンデザイン
- セーブ/ロード画面
- 設定画面

### 2. プロンプト生成システム

#### プロンプト構造
```
[基本描写] + [スタイル指定] + [技術仕様] + [雰囲気・感情] + [ネガティブプロンプト]
```

#### キャラクタープロンプトテンプレート
```
基本: 美しい少女、薄い色素の髪、白いワンピース
スタイル: アニメ風、ビジュアルノベル、日本のゲームアート
技術: 高解像度、透明背景、PNG形式
雰囲気: 幻想的、儚い、神秘的
ネガティブ: リアル写真、3D、低品質、ノイズ
```

### 3. スタイルガイドシステム

#### 色彩パレット
- **メインカラー**: ステンドグラスの色彩（青、赤、黄、緑の透明感）
- **アクセントカラー**: 夕暮れのオレンジ、菜の花の黄色
- **ベースカラー**: 教会の石材グレー、木材ブラウン

#### アートスタイル
- **全体**: 日本のビジュアルノベル風
- **キャラクター**: アニメ調、柔らかい線画
- **背景**: 写実的だが温かみのある色調
- **エフェクト**: ガラス質感、光の表現重視

## データモデル

### アセット情報構造
```typescript
interface AssetInfo {
  id: string;
  name: string;
  category: 'background' | 'character' | 'ui' | 'effect';
  priority: 'high' | 'medium' | 'low';
  status: 'not_started' | 'in_progress' | 'review' | 'completed' | 'implemented';
  specifications: {
    resolution: string;
    format: string;
    transparency: boolean;
    variations: string[];
  };
  usageContext: string[];
  generationPrompt: string;
  negativePrompt: string;
  filePath?: string;
  createdDate?: Date;
  lastModified?: Date;
}
```

### プロンプト構造
```typescript
interface GenerationPrompt {
  id: string;
  assetId: string;
  basePrompt: string;
  styleModifiers: string[];
  technicalSpecs: string[];
  atmosphereKeywords: string[];
  negativePrompt: string;
  variations: PromptVariation[];
}

interface PromptVariation {
  name: string;
  modifiers: string[];
  description: string;
}
```

## エラーハンドリング

### 生成エラー対応
1. **プロンプト最適化失敗**: 代替プロンプトの自動提案
2. **品質基準未達**: 再生成ガイダンスの提供
3. **技術仕様不適合**: 仕様調整の推奨事項表示

### ファイル管理エラー
1. **重複ファイル**: 自動リネーミングとバージョン管理
2. **形式不適合**: 自動変換ツールの提案
3. **容量制限**: 最適化オプションの提示

## テスト戦略

### 単体テスト
- プロンプト生成ロジックの検証
- アセット分類システムの正確性
- ファイル管理機能の動作確認

### 統合テスト
- AI生成ツールとの連携テスト
- ゲームエンジンへの統合テスト
- ワークフロー全体の動作確認

### 品質テスト
- 生成画像の品質評価
- スタイル一貫性の確認
- 物語との整合性チェック

### ユーザビリティテスト
- 制作者向けインターフェースの使いやすさ
- プロンプトの理解しやすさ
- ワークフロー効率性の評価

## パフォーマンス考慮事項

### 最適化戦略
1. **プロンプトキャッシュ**: 頻繁に使用されるプロンプトの事前生成
2. **バッチ処理**: 複数アセットの一括生成サポート
3. **プログレッシブ品質**: 段階的品質向上システム

### リソース管理
1. **ファイルサイズ最適化**: 自動圧縮とフォーマット変換
2. **バージョン管理**: 効率的な差分管理システム
3. **ストレージ最適化**: 使用頻度に基づく階層化ストレージ

## セキュリティ考慮事項

### アセット保護
1. **著作権管理**: 生成アセットの権利情報記録
2. **アクセス制御**: 制作チーム向けの権限管理
3. **バックアップ**: 定期的な自動バックアップシステム

### プロンプト保護
1. **機密情報除去**: 個人情報や機密データの自動検出・除去
2. **プロンプト暗号化**: 重要なプロンプトの暗号化保存
3. **監査ログ**: アセット生成・修正の完全な履歴管理
